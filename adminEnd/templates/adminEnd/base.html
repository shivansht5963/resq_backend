{% load static %}
<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>ResQ Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <link href="{% static 'adminEnd/css/custom.css' %}" rel="stylesheet">
    <style>
      :root {
        --bg-primary: #f9fafb;
        --bg-secondary: #ffffff;
        --text-primary: #1f2937;
        --text-secondary: #6b7280;
        --border-color: #e5e7eb;
        --grid-color: rgba(124, 58, 237, 0.08);
      }

      [data-theme="dark"] {
        --bg-primary: #1a1a2e;
        --bg-secondary: #16213e;
        --text-primary: #f0f0f0;
        --text-secondary: #b0b0b0;
        --border-color: #2d3748;
        --grid-color: rgba(168, 85, 247, 0.1);
      }

      body {
        background-color: var(--bg-primary);
        background-image: 
          linear-gradient(0deg, var(--grid-color) 1px, transparent 1px),
          linear-gradient(90deg, var(--grid-color) 1px, transparent 1px);
        background-size: 50px 50px;
        color: var(--text-primary);
        background-attachment: fixed;
      }

      .container-lg {
        background-color: transparent;
      }

      [data-theme="dark"] .navbar {
        background: var(--bg-secondary) !important;
        border-bottom: 1px solid var(--border-color);
      }

      [data-theme="dark"] .card {
        background-color: var(--bg-secondary);
        color: var(--text-primary);
        border-color: var(--border-color);
      }

      [data-theme="dark"] .table {
        background: var(--bg-secondary);
        color: var(--text-primary);
      }

      [data-theme="dark"] .table thead {
        background-color: rgba(0, 0, 0, 0.3);
      }

      [data-theme="dark"] .table tbody tr:hover {
        background-color: rgba(255, 255, 255, 0.05);
      }

      [data-theme="dark"] .table tbody tr {
        border-bottom-color: var(--border-color);
      }

      [data-theme="dark"] .form-control,
      [data-theme="dark"] .form-select {
        background-color: rgba(255, 255, 255, 0.05);
        color: var(--text-primary);
        border-color: var(--border-color);
      }

      [data-theme="dark"] .form-control:focus,
      [data-theme="dark"] .form-select:focus {
        background-color: rgba(255, 255, 255, 0.1);
        color: var(--text-primary);
        border-color: #a78bfa;
      }

      [data-theme="dark"] h1,
      [data-theme="dark"] h2,
      [data-theme="dark"] h3,
      [data-theme="dark"] h4,
      [data-theme="dark"] h5,
      [data-theme="dark"] h6 {
        color: var(--text-primary);
      }

      [data-theme="dark"] .text-muted {
        color: var(--text-secondary) !important;
      }

      [data-theme="dark"] .navbar .nav-link {
        color: var(--text-secondary) !important;
      }

      [data-theme="dark"] .navbar .nav-link:hover {
        color: #a78bfa !important;
      }

      .theme-toggle {
        border: 1px solid var(--border-color);
        background-color: transparent;
        color: var(--text-primary);
        padding: 0.5rem 1rem;
        border-radius: 8px;
        cursor: pointer;
        transition: all 0.2s ease;
      }

      .theme-toggle:hover {
        background-color: rgba(124, 58, 237, 0.1);
        color: #7c3aed;
      }

      [data-theme="dark"] .theme-toggle {
        border-color: var(--border-color);
        background-color: rgba(168, 85, 247, 0.05);
        color: #a78bfa;
      }

      [data-theme="dark"] .theme-toggle:hover {
        background-color: rgba(168, 85, 247, 0.15);
      }
    </style>
  </head>
  <body data-theme="light">
    <nav class="navbar navbar-expand-lg sticky-top border-bottom" style="background: linear-gradient(to right, #ffffff, #f9fafb);">
      <div class="container-lg">
        <a class="navbar-brand fw-700" href="{% url 'adminEnd:dashboard' %}" style="font-size: 1.5rem; letter-spacing: -0.5px;">
          <span style="color: #7c3aed;">ResQ</span>
        </a>
        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#nav" aria-controls="nav" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="nav">
          {% url 'adminEnd:dashboard' as dashboard_url %}
          {% url 'adminEnd:incident_list' as incidents_url %}
          {% url 'adminEnd:beacon_list' as beacons_url %}
          {% url 'adminEnd:guard_list' as guards_url %}
          <ul class="navbar-nav ms-auto gap-2 mb-2 mb-lg-0">
            <li class="nav-item"><a class="nav-link fw-500 {% if request.resolver_match.url_name == 'dashboard' %}text-primary{% else %}text-muted{% endif %}" href="{{ dashboard_url }}"><i class="bi bi-speedometer2 me-1"></i>Dashboard</a></li>
            <li class="nav-item"><a class="nav-link fw-500 {% if 'incident' in request.resolver_match.url_name %}text-primary{% else %}text-muted{% endif %}" href="{{ incidents_url }}"><i class="bi bi-exclamation-triangle me-1"></i>Incidents</a></li>
            <li class="nav-item"><a class="nav-link fw-500 {% if 'beacon' in request.resolver_match.url_name %}text-primary{% else %}text-muted{% endif %}" href="{{ beacons_url }}"><i class="bi bi-broadcast me-1"></i>Beacons</a></li>
            <li class="nav-item"><a class="nav-link fw-500 {% if 'guard' in request.resolver_match.url_name %}text-primary{% else %}text-muted{% endif %}" href="{{ guards_url }}"><i class="bi bi-person-badge me-1"></i>Guards</a></li>
          </ul>
          <ul class="navbar-nav ms-auto gap-2">
            <li class="nav-item">
              <button id="themeToggle" class="theme-toggle" title="Toggle dark mode">
                <i class="bi bi-sun-fill me-2"></i><span id="themeText">Dark</span>
              </button>
            </li>
            {% if request.user.is_authenticated %}
            <li class="nav-item dropdown">
              <a class="nav-link dropdown-toggle" href="#" id="userDropdown" role="button" data-bs-toggle="dropdown">
                <i class="bi bi-person-circle me-1"></i>{{ request.user.full_name }}
              </a>
              <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                <li><a class="dropdown-item" href="/logout/"><i class="bi bi-box-arrow-right me-2"></i>Logout</a></li>
              </ul>
            </li>
            {% else %}
            <li class="nav-item"><a class="nav-link" href="/login/"><i class="bi bi-box-arrow-in-right me-1"></i>Login</a></li>
            {% endif %}
          </ul>
        </div>
      </div>
    </nav>

    <div class="container-lg py-4">
      {% if messages %}
        {% for message in messages %}
          <div class="alert alert-{{ message.tags }} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
          </div>
        {% endfor %}
      {% endif %}

      {% if adminend_view_only %}
        <div class="alert alert-info alert-dismissible fade show" role="alert">
          <i class="bi bi-eye me-2"></i><strong>View-Only Mode:</strong> This admin panel is running in view-only mode â€” write operations are disabled.
          <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
        </div>
      {% endif %}

      {% block content %}{% endblock %}
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      // Dark mode toggle
      const themeToggle = document.getElementById('themeToggle');
      const themeText = document.getElementById('themeText');
      const body = document.body;

      // Check localStorage for saved theme preference
      const savedTheme = localStorage.getItem('adminend-theme') || 'light';
      body.setAttribute('data-theme', savedTheme);
      updateThemeIcon(savedTheme);

      // Theme toggle button click handler
      themeToggle.addEventListener('click', function() {
        const currentTheme = body.getAttribute('data-theme');
        const newTheme = currentTheme === 'light' ? 'dark' : 'light';
        
        body.setAttribute('data-theme', newTheme);
        localStorage.setItem('adminend-theme', newTheme);
        updateThemeIcon(newTheme);
      });

      function updateThemeIcon(theme) {
        const icon = themeToggle.querySelector('i');
        if (theme === 'dark') {
          icon.className = 'bi bi-moon-stars-fill me-2';
          themeText.textContent = 'Light';
        } else {
          icon.className = 'bi bi-sun-fill me-2';
          themeText.textContent = 'Dark';
        }
      }
    </script>
  </body>
</html>
